const url = require('url');
const router = global.router;
const needle = require('needle');
const apicache = require('apicache');
const API_BASE_URL = process.env.TEST_BASE_URL;


let cache = apicache.middleware;

router.get('/api/info/', (req, res) => {
    res.status(200).json("This is the root of info.  Please use an endpoint.")
})

router.get('/api/info/test', cache('2 minutes'), (req, res) => {
    try {
        const params = new URLSearchParams({
            ...url.parse(req.url, true).query
        })

        needle.get(`${API_BASE_URL}?${params}`, (error, response, body) => {
            const status = response.statusCode || 500
            if(error) throw error
            res.status(status).json(body)
        })
       
    } catch (error) {
        console.log(`caught error ${error}`)
        res.status(500).json({ error })
    }
   
})

module.exports = router;